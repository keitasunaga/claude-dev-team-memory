# ユーザー認証機能 - タスクリスト

## 実装タスク一覧

### Phase 1: 基盤実装（1週間）

- [ ] プロジェクト初期設定
  - [ ] NestJSプロジェクトのセットアップ
  - [ ] 必要なパッケージのインストール
  - [ ] 環境変数の設定

- [ ] データベース設計と実装
  - [ ] Prismaスキーマの作成
  - [ ] マイグレーションファイルの作成
  - [ ] シードデータの準備

- [ ] 基本的なAPI構造の実装
  - [ ] 認証モジュールの作成
  - [ ] DTOクラスの定義
  - [ ] バリデーションパイプの設定

### Phase 2: 従来型認証の実装（1週間）

- [ ] ユーザー登録機能
  - [ ] 登録エンドポイントの実装
  - [ ] メールアドレス検証
  - [ ] パスワードハッシュ化

- [ ] ログイン/ログアウト機能
  - [ ] ログインエンドポイントの実装
  - [ ] JWTトークン生成
  - [ ] ログアウト処理

- [ ] セッション管理
  - [ ] Redisセットアップ
  - [ ] セッション保存/取得
  - [ ] トークンリフレッシュ機能

### Phase 3: DID認証の実装（2週間）

- [ ] ウォレット連携
  - [ ] MetaMask接続機能
  - [ ] 署名検証ロジック
  - [ ] ナンス生成と管理

- [ ] DIDドキュメント検証
  - [ ] DID解決機能
  - [ ] 公開鍵検証
  - [ ] DIDベースのユーザー作成

- [ ] ハイブリッド認証
  - [ ] 既存ユーザーとDIDの紐付け
  - [ ] 認証方式の切り替え
  - [ ] 統一的なセッション管理

### Phase 4: セキュリティ強化（1週間）

- [ ] レート制限
  - [ ] ブルートフォース対策
  - [ ] APIレート制限
  - [ ] IPベースの制限

- [ ] 2要素認証
  - [ ] TOTP実装
  - [ ] バックアップコード生成
  - [ ] 2FA設定API

- [ ] セキュリティヘッダー
  - [ ] CORS設定
  - [ ] CSRFトークン
  - [ ] セキュリティヘッダーの追加

### Phase 5: テストとドキュメント（1週間）

- [ ] ユニットテスト
  - [ ] サービスクラスのテスト
  - [ ] コントローラーのテスト
  - [ ] 認証ミドルウェアのテスト

- [ ] 統合テスト
  - [ ] E2Eテストの作成
  - [ ] 認証フローのテスト
  - [ ] エラーケースのテスト

- [ ] ドキュメント作成
  - [ ] API仕様書（OpenAPI）
  - [ ] 実装ガイド
  - [ ] セキュリティガイドライン

## 見積もり工数

- 総工数: 6週間（1人月半）
- バッファ: 1週間
- 合計: 7週間

## 依存関係

- Smart Contractsの実装完了（DID Registry）
- Redisインフラの準備
- SSL証明書の取得